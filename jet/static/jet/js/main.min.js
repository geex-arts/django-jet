(function(e){e(document).ready(function(){var t=function(){e(".changelist-filter-select").on("change",function(){var t=e(this),n=t.find("option:selected"),r=n.data("url"),i=t.data("queryset--lookup");r?document.location=n.data("url"):i&&(document.location="?"+i+"="+n.val())})},n=function(){var t=e(".changeform-tabs-item"),n=e(".module");e(".changeform-tabs-item-link").click(function(r){var i=e(this),s=i.closest(".changeform-tabs-item"),o=i.data("module-id");t.removeClass("selected"),s.addClass("selected");var u=n.removeClass("selected").filter("#"+o).addClass("selected");u.find("select").trigger("select:init"),r.preventDefault()})},r=function(){var t=0,n="unique_checkbox_id_",r=function(r){var i=r.attr("id")?r.attr("id"):n+t++,s=e("<label>").attr("for",i);r.hide().attr("id",i),s.insertAfter(r)},i=function(){var t=e(".action-checkbox, .action-checkbox-column").add(".tabular.inline-related .form-row"),n=t.find('input[type="checkbox"]').add(".checkbox-without-label");n.each(function(){r(e(this))})};i()},i=function(){var t=e(".top-user-tools"),n;t.on("mouseenter",function(){n&&clearTimeout(n),t.addClass("opened")}),t.on("mouseleave",function(){n=setTimeout(function(){t.removeClass("opened"),n=null},200)})},s=function(){var t=function(){var t=e(".sidebar-popup-container"),n=e(".sidebar-popup"),r=e(".sidebar-popup-item"),i=e(".popup-item-link"),s,o,u,a,f=function(){return u.find(".sidebar-popup-list-item:visible")},l=function(){f().removeClass("selected")},c=function(){r.each(function(){var t=e(this),n=t.find(".sidebar-popup-search"),r=t.find(".sidebar-popup-list-item");n.on("change keyup",function(){var n=e(this).val();r.hide(),t.find('.sidebar-popup-list-item-link:icontains("'+n+'")').closest(".sidebar-popup-list-item").show()})})},h=function(n){d();var s=n.data("popup-item-id"),o=e("#"+s),f=o.find(".sidebar-popup-search");r.hide(),o.show(),t.stop().fadeIn(200,"swing"),i.removeClass("hovered"),n.addClass("hovered"),e("body").addClass("non-scrollable"),u=o,a=null,l(),f.val("").trigger("change").focus()},p=function(){o=setTimeout(function(){r.hide(),t.stop().fadeOut(200,"swing"),i.removeClass("hovered"),e("body").removeClass("non-scrollable"),u=null},200)},d=function(){o!=null&&clearTimeout(o),o=null};i.on("mouseenter",function(){s=e(this),h(s)}),i.on("mouseleave",function(t){var n=e(t.toElement);if(n.hasClass("sidebar-popup")||n.parents(".sidebar-popup").length)return;p()}),n.on("mouseenter",function(e){d()}),n.on("mouseleave",function(t){var n=e(t.toElement);if(n.hasClass("popup-item-link")&&s.data("popup-item-id")==n.data("popup-item-id"))return;p()}),n.find(".sidebar-popup-list-item-link").on("mouseenter",function(){var t=e(this),n=t.closest(".sidebar-popup-list-item");a=n,l(),a.addClass("selected")});var v=function(e){a!=null&&(a=e?a.nextAll(":visible").first():a.prevAll(":visible").first());if(a==null||a.length==0)a=e?f().first():f().last();l(),a.addClass("selected")};e(document).keydown(function(e){if(u==null)return;if(e.which==38)v(!1);else if(e.which==40)v(!0);else{if(e.which!=13)return;a&&(document.location=a.find("a").attr("href"))}e.preventDefault()}),c()},n=function(){var t=e("#bookmarks-add-form"),n=e("#bookmarks-remove-form"),r=t.find('input[name="title"]'),i=t.find('input[name="url"]'),s=n.find('input[name="id"]');e(".bookmarks-add").on("click",function(n){n.preventDefault();var s=e(this),o=s.data("title")?s.data("title"):document.title,u=window.location.href;r.val(o),i.val(u);var a=function(){e.ajax({url:t.attr("action"),method:t.attr("method"),dataType:"json",data:t.serialize(),success:function(t){if(t.error)return;var n=e(".bookmarks-list"),i=e(".sidebar-menu-item-list-item.empty").clone().removeClass("empty");i.find(".sidebar-menu-item-list-item-link").attr("href",u).append(r.val()),i.find(".sidebar-menu-item-list-item-link-remove").attr("data-bookmark-id",t.id),n.append(i)}})},f={};f[django.gettext("Add")]=function(){a(),e(this).dialog("close")},f[django.gettext("Cancel")]=function(){e(this).dialog("close")},e("#bookmarks-add-dialog").dialog({resizable:!1,modal:!0,buttons:f})}),e(document).on("click",".bookmarks-remove",function(t){t.preventDefault();var r=e(this),i=r.data("bookmark-id"),o=function(){s.val(i),e.ajax({url:n.attr("action"),method:n.attr("method"),dataType:"json",data:n.serialize(),success:function(e){if(e.error)return;var t=r.closest(".sidebar-menu-item-list-item");t.remove()}})},u={};u[django.gettext("Delete")]=function(){o(),e(this).dialog("close")},u[django.gettext("Cancel")]=function(){e(this).dialog("close")},e("#bookmarks-remove-dialog").dialog({resizable:!1,modal:!0,buttons:u})})},r=function(){var t=e(".apps-list"),n=e(".apps-list-pinned"),r=e(".apps-hide"),i=function(){var e;t.is(":visible")?e=django.gettext("Hide applications"):e=django.gettext("Show hidden"),r.text(e),t.children().length!=0&&n.children().length!=0||!t.is(":visible")?r.show():r.hide()};r.on("click",function(e){e.preventDefault(),t.slideFadeToggle(200,"swing",function(){localStorage.side_menu_apps_list_visible=t.is(":visible"),i()})}),e(".app-item .pin-toggle").on("click",function(t){var n=e(this).closest(".app-item"),r=n.data("app-label"),s=e("#toggle-application-pin-form");s.find('input[name="app_label"]').val(r),e.ajax({url:s.attr("action"),method:s.attr("method"),dataType:"json",data:s.serialize(),success:function(t){if(t.error)return;var r=t.pinned?e(".apps-list-pinned"):e(".apps-list");t.pinned?n.addClass("pinned"):n.removeClass("pinned"),n.detach(),n.appendTo(r),i()}}),t.preventDefault()}),localStorage.side_menu_apps_list_visible==="false"&&(n.children().length!=0?t.hide():localStorage.side_menu_apps_list_visible=!0),i()};t(),n(),r()},o=function(){e(".delete-objects-list-item.collapsable").each(function(){var t=e(this),n=t.find(".delete-objects-list-item-row-collapse"),r=t.find(".delete-objects-list-item-collapsable");n.on("click",function(e){e.preventDefault(),r.slideToggle(200,"swing")})})},u=function(){e.expr[":"].icontains=e.expr.createPseudo(function(t){return function(n){
return e(n).text().toUpperCase().indexOf(t.toUpperCase())>=0}})},a=function(){e.fn.slideFadeToggle=function(e,t,n){return this.animate({opacity:"toggle",height:"toggle"},e,t,n)}},f=function(){var t=function(e){var t=e[0].previousSibling;t.parentNode.removeChild(t)},n=function(e){return e.toLowerCase().replace(/%\w/g,function(e){return e=e.replace(/%/,""),e+e})},r=function(){e(".form-row .datetime").each(function(){var n=e(this),r=n.find(".vDateField"),i=n.find(".vTimeField");t(r),t(i),r.nextAll("br").first().remove()})},i=function(){e(".form-row .vDateField").each(function(){var t=e(this),r=e('<a href="#">').addClass("vDateField-link"),i=e("<span>").addClass("icon-calendar");r.append(i).insertAfter(t),t.datepicker({dateFormat:n(DATE_FORMAT),showButtonPanel:!0,nextText:"",prevText:""}),r.on("click",function(e){t.datepicker("widget").is(":visible")?t.datepicker("hide"):t.datepicker("show"),e.preventDefault()})});var t=e.datepicker._gotoToday;e.datepicker._gotoToday=function(e){t.call(this,e),this._selectDate(e)}},s=function(){e(".form-row .vTimeField").each(function(){var t=e(this),n=e('<a href="#">').addClass("vTimeField-link"),r=e("<span>").addClass("icon-clock");n.append(r).insertAfter(t),t.timepicker({showPeriodLabels:!1,showCloseButton:!0,showNowButton:!0}),n.on("click",function(e){t.datepicker("widget").is(":visible")?t.datepicker("hide"):t.timepicker("show"),e.preventDefault()})})};r(),i(),s()},l=function(){e(".module").each(function(){var t=e(this),n=function(){return t.find(".stacked-inline-list-item")},r=function(){return t.find(".inline-related")};t.on("click",".stacked-inline-list-item-link",function(t){var i=e(this),s=i.closest(".stacked-inline-list-item"),o=i.data("inline-related-id");n().removeClass("selected"),s.addClass("selected"),r().removeClass("selected").filter("#"+o).addClass("selected"),t.preventDefault()}),t.on("click",".stacked-inline-list-item-link-remove",function(t){var n=e(this).closest(".stacked-inline-list-item-link"),i=n.closest(".stacked-inline-list-item"),s=n.data("inline-related-id");i.remove(),r().filter("#"+s).remove(),t.preventDefault()}),t.find(".inline-related").each(function(){var n=e(this);n.find(".delete input").on("change",function(r){var i=e(this),s=n.attr("id"),o=t.find('.stacked-inline-list-item-link[data-inline-related-id="'+s+'"]'),u=o.closest(".stacked-inline-list-item");i.is(":checked")?u.addClass("delete"):u.removeClass("delete")})}),t.find(".add-row a").on("click",function(){t.find("select").trigger("select:init")})})},c=function(){var t=function(){var t=e(".results thead");if(t.length==0)return;var n=t.clone(),r=e("<table>").addClass("table helper").append(n);r.find(".action-checkbox-column").empty(),r.appendTo(document.body);var i=function(){e(window).scrollTop()>t.offset().top?r.show():r.hide()},s=function(){var r=t.find("th"),i=n.find("th");r.each(function(t){i.eq(t).css("width",e(this).width())})};e(window).on("scroll",i),e(window).on("resize",s),s()},n=function(){var t=e(".changelist-footer");if(t.length==0)return;var n=function(){t.each(function(){var t=e(this),n=t.siblings(".results");if(e(window).scrollTop()+e(window).height()<e(document).height()){if(!t.hasClass("fixed")){var r=e(window).scrollTop();t.addClass("fixed"),n.css("margin-bottom",t.outerHeight(!1)-20-2+"px"),e(window).scrollTop(r)}}else t.hasClass("fixed")&&(t.removeClass("fixed"),n.css("margin-bottom",0))})};e(window).on("scroll",n),e(window).on("resize",n),n()},r=function(){e('img[src$="admin/img/icon-yes.gif"]').after(e('<span class="icon-tick">')),e('img[src$="admin/img/icon-no.gif"]').after(e('<span class="icon-cross">')),e('img[src$="admin/img/icon-unknown.gif"]').after(e('<span class="icon-question">'))};t(),n(),r()},h=function(){e("a[title],.tooltip[title]").tooltip({track:!0})},p=function(){var t=function(){var t=e("#update-dashboard-modules-form"),n=[];e(".dashboard-column").each(function(){var t=e(this),r=t.closest(".dashboard-column-wrapper").index();t.find(".dashboard-item").each(function(){var t=e(this),i=t.index(),s=t.data("module-id");n.push({id:s,column:r,order:i})})}),t.find('[name="modules"]').val(JSON.stringify(n)),e.ajax({url:t.attr("action"),method:t.attr("method"),dataType:"json",data:t.serialize()})};e(".dashboard-column").droppable({activeClass:"active",hoverClass:"hovered",tolerance:"pointer",accept:".dashboard-item"}).sortable({items:".dashboard-item",handle:".dashboard-item-header",tolerance:"pointer",connectWith:".dashboard-column",cursor:"move",placeholder:"dashboard-item placeholder",forcePlaceholderSize:!0,update:function(e,n){t()}}),e(".dashboard-item.collapsible").each(function(){var t=e(this),n=t.find(".dashboard-item-collapse"),r=t.find(".dashboard-item-content"),i=e("#update-dashboard-module-collapse-form"),s=t.data("module-id");n.on("click",function(n){n.preventDefault(),r.slideFadeToggle(200,"swing",function(){var n=r.is(":visible")==0;n?t.addClass("collapsed"):t.removeClass("collapsed"),i.find('[name="id"]').val(s),i.find('[name="collapsed"]').val(n?"true":"false"),e.ajax({url:i.attr("action"),method:i.attr("method"),dataType:"json",data:i.serialize()})})})}),e(".dashboard-item.deletable").each(function(){var t=e(this),n=t.find(".dashboard-item-remove"),r=e("#remove-dashboard-module-form"),i=t.data("module-id");n.on("click",function(n){n.preventDefault();var s={},o=function(){t.fadeOut(200,"swing",function(){r.find('[name="id"]').val(i),e.ajax({url:r.attr("action"),method:r.attr("method"),dataType:"json",data:r.serialize()})})};s[django.gettext("Delete")]=function(){o(),e(this).dialog("close")},s[django.gettext("Cancel")]=function(){e(this).dialog("close")},e("#module-remove-dialog").dialog({resizable:!1,modal:!0,buttons:s})})});var n=e("#add-dashboard-module-form");n.find(".add-dashboard-link").on("click",function(t){var r=n.find('[name="type"]'),i=n.find('[name="module"] option:selected').data("type");i&&(r.val(i),e.ajax({url:n.attr("action"),method:n.attr("method"),dataType:"json",data:n.serialize(),success:function(e){if(e.
error)return;document.location=e.success_url}})),t.preventDefault()}),e(".dashboard-item.ajax").each(function(){var t=e(this),r=t.find(".dashboard-item-content"),i=t.data("ajax-url"),s=t.data("module-id");n.find('[name="id"]').val(s),e.ajax({url:i,dataType:"json",success:function(e){if(e.error){r.empty();return}var t=r.height();r.html(e.html);var n=r.height();r.height(t),r.animate({height:n},250)},error:function(){r.empty()}})}),e(".reset-dashboard-link").on("click",function(t){var n={},r=function(){var t=e("#reset-dashboard-form");e.ajax({url:t.attr("action"),method:t.attr("method"),dataType:"json",data:t.serialize(),success:function(e){if(e.error)return;location.reload()}})};n[django.gettext("Yes")]=function(){r(),e(this).dialog("close")},n[django.gettext("Cancel")]=function(){e(this).dialog("close")},e("#reset-dashboard-dialog").dialog({resizable:!1,modal:!0,buttons:n}),t.preventDefault()})},d=function(){var t=e(".changeform");if(t.length){var n=t.find("input, textarea, select"),r=!1,i=function(){return django.gettext("Warning: you have unsaved changes")},s=function(){n.off("change",s),r||(e(window).bind("beforeunload",i),r=!0)};e(document).on("submit","form",function(){e(window).off("beforeunload",i)}),n.on("change",s)}},v=function(){e(".sidebar-menu-wrapper").perfectScrollbar()},m=function(){e(".choose-theme").on("click",function(){var t=e(this);e.cookie("JET_THEME",t.data("theme"),{expires:365,path:"/"});var n=[{url:t.data("base-stylesheet"),"class":"base-stylesheet"},{url:t.data("select2-stylesheet"),"class":"select2-stylesheet"},{url:t.data("jquery-ui-stylesheet"),"class":"jquery-ui-stylesheet"}],r=0,i=function(){++r,r==n.length&&e(document).trigger("theme:changed")};n.forEach(function(t){e("<link>").attr("rel","stylesheet").addClass(t["class"]).attr("href",t.url).load(i).appendTo("head"),e("."+t["class"]).slice(0,-2).remove()}),e(".choose-theme").removeClass("selected"),t.addClass("selected")})},g=function(){var t=function(){var t=e(".related-popup"),n=e(".related-popup-container"),r=t.last();r.remove(),t.length==1&&n.fadeOut(200,"swing",function(){e(".related-popup-back").hide(),e("body").removeClass("non-scrollable")})};e(".related-popup-back").on("click",function(e){e.preventDefault(),t()}),e(window).on("related-popup:close",function(){t()})};u(),a(),t(),n(),r(),i(),s(),o(),f(),l(),c(),h(),p(),d(),v(),m(),g()})})(jet.jQuery);
