!function(e){e(document).ready(function(){var t=function(){e(".changelist-filter-select").on("change",function(){var t=e(this),i=t.find("option:selected"),a=i.data("url"),n=t.data("queryset--lookup");a?document.location=i.data("url"):n&&(document.location="?"+n+"="+i.val())})},i=function(){var t=e(".changeform-tabs-item"),i=e(".module");e(".changeform-tabs-item-link").click(function(a){var n=e(this),o=n.closest(".changeform-tabs-item"),l=n.data("module-id");t.removeClass("selected"),o.addClass("selected");var s=i.removeClass("selected").filter("#"+l).addClass("selected");s.find("select").trigger("select:init"),a.preventDefault()})},a=function(){var t=0,i="unique_checkbox_id_",a=function(a){var n=a.attr("id")?a.attr("id"):i+t++,o=e("<label>").attr("for",n);a.hide().attr("id",n),o.insertAfter(a)},n=function(){var t=e(".action-checkbox, .action-checkbox-column").add(".tabular.inline-related .form-row"),i=t.find('input[type="checkbox"]').add(".checkbox-without-label").add('label > input[type="checkbox"]');i.each(function(){a(e(this))})};n()},n=function(){var t,i=e(".top-user-tools");i.on("mouseenter",function(){t&&clearTimeout(t),i.addClass("opened")}),i.on("mouseleave",function(){t=setTimeout(function(){i.removeClass("opened"),t=null},200)})},o=function(){var t=function(){var t,i,a,n,o=e(".sidebar-popup-container"),l=e(".sidebar-popup"),s=e(".sidebar-popup-item"),d=e(".popup-item-link"),r=null,c=null,u=function(){return a.find(".sidebar-popup-list-item:visible")},f=function(){u().removeClass("selected")},p=function(){s.each(function(){var t=e(this),i=t.find(".sidebar-popup-search"),a=t.find(".sidebar-popup-list-item");i.on("change keyup",function(){var i=e(this).val();a.hide(),t.find('.sidebar-popup-list-item-link:icontains("'+i+'")').closest(".sidebar-popup-list-item").show()})})},m=function(t){v(),c=t;var i=t.data("popup-item-id"),l=e("#"+i),r=l.find(".sidebar-popup-search");s.hide(),l.show(),o.stop().fadeIn(200,"swing"),d.removeClass("hovered"),t.addClass("hovered"),e("body").addClass("non-scrollable"),a=l,n=null,f(),r.val("").trigger("change").focus()},h=function(){i=setTimeout(function(){s.hide(),o.stop().fadeOut(200,"swing"),d.removeClass("hovered"),e("body").removeClass("non-scrollable"),a=null,c=null},200)},v=function(){null!=i&&clearTimeout(i),i=null},b=function(){null!==r&&clearTimeout(r),r=null};d.on("mouseenter",function(){t=e(this),v(),null===c?(b(),r=setTimeout(function(){m(t)},200)):c!==t?(b(),r=setTimeout(function(){m(t)},500)):b()}),d.on("mouseleave",function(t){var i=e(t.toElement);i.hasClass("sidebar-popup")||i.parents(".sidebar-popup").length||h()}),l.on("mouseenter",function(){v(),b()}),l.on("mouseleave",function(i){var a=e(i.toElement);a.hasClass("popup-item-link")&&t.data("popup-item-id")==a.data("popup-item-id")||h()}),l.find(".sidebar-popup-list-item-link").on("mouseenter",function(){var t=e(this),i=t.closest(".sidebar-popup-list-item");n=i,f(),n.addClass("selected")});var g=function(e){null!=n&&(n=e?n.nextAll(":visible").first():n.prevAll(":visible").first()),(null==n||0==n.length)&&(n=e?u().first():u().last()),f(),n.addClass("selected")};e(document).keydown(function(e){if(null!=a){if(38==e.which)g(!1);else if(40==e.which)g(!0);else{if(13!=e.which)return;n&&(document.location=n.find("a").attr("href"))}e.preventDefault()}}),p()},i=function(){var t=e("#bookmarks-add-form"),i=e("#bookmarks-remove-form"),a=t.find('input[name="title"]'),n=t.find('input[name="url"]'),o=i.find('input[name="id"]');e(".bookmarks-add").on("click",function(i){i.preventDefault();var o=e(this),l=o.data("title")?o.data("title"):document.title,s=window.location.href;a.val(l),n.val(s);var d=function(){e.ajax({url:t.attr("action"),method:t.attr("method"),dataType:"json",data:t.serialize(),success:function(t){if(!t.error){var i=e(".bookmarks-list"),n=e(".sidebar-menu-item-list-item.empty").clone().removeClass("empty");n.find(".sidebar-menu-item-list-item-link").attr("href",s).append(a.val()),n.find(".sidebar-menu-item-list-item-link-remove").attr("data-bookmark-id",t.id),i.append(n)}}})},r={};r[django.gettext("Add")]=function(){d(),e(this).dialog("close")},r[django.gettext("Cancel")]=function(){e(this).dialog("close")},e("#bookmarks-add-dialog").dialog({resizable:!1,modal:!0,buttons:r})}),e(document).on("click",".bookmarks-remove",function(t){t.preventDefault();var a=e(this),n=a.data("bookmark-id"),l=function(){o.val(n),e.ajax({url:i.attr("action"),method:i.attr("method"),dataType:"json",data:i.serialize(),success:function(e){if(!e.error){var t=a.closest(".sidebar-menu-item-list-item");t.remove()}}})},s={};s[django.gettext("Delete")]=function(){l(),e(this).dialog("close")},s[django.gettext("Cancel")]=function(){e(this).dialog("close")},e("#bookmarks-remove-dialog").dialog({resizable:!1,modal:!0,buttons:s})})},a=function(){var t=e(".apps-list"),i=e(".apps-list-pinned"),a=e(".apps-hide"),n=function(){var e;e=django.gettext(t.is(":visible")?"Hide applications":"Show hidden"),a.text(e),0!=t.children().length&&0!=i.children().length||!t.is(":visible")?a.show():a.hide()};a.on("click",function(e){e.preventDefault(),t.slideFadeToggle(200,"swing",function(){localStorage.side_menu_apps_list_visible=t.is(":visible"),n()})}),e(".app-item .pin-toggle").on("click",function(t){var i=e(this).closest(".app-item"),a=i.data("app-label"),o=e("#toggle-application-pin-form");o.find('input[name="app_label"]').val(a),e.ajax({url:o.attr("action"),method:o.attr("method"),dataType:"json",data:o.serialize(),success:function(t){if(!t.error){var a=e(t.pinned?".apps-list-pinned":".apps-list");t.pinned?i.addClass("pinned"):i.removeClass("pinned"),i.detach(),i.appendTo(a),n()}}}),t.preventDefault()}),"false"===localStorage.side_menu_apps_list_visible&&(0!=i.children().length?t.hide():localStorage.side_menu_apps_list_visible=!0),n()};t(),i(),a()},l=function(){e(".delete-objects-list-item.collapsable").each(function(){var t=e(this),i=t.find(".delete-objects-list-item-row-collapse"),a=t.find(".delete-objects-list-item-collapsable");i.on("click",function(e){e.preventDefault(),a.slideToggle(200,"swing")})})},s=function(){e.expr[":"].icontains=e.expr.createPseudo(function(t){return function(i){return e(i).text().toUpperCase().indexOf(t.toUpperCase())>=0}})},d=function(){e.fn.slideFadeToggle=function(e,t,i){return this.animate({opacity:"toggle",height:"toggle"},e,t,i)}},r=function(){var t=function(e){var t=e[0].previousSibling;t.parentNode.removeChild(t)},i=function(e){return e.toLowerCase().replace(/%\w/g,function(e){return e=e.replace(/%/,""),e+e})},a=function(){e(".form-row .datetime").each(function(){var i=e(this),a=i.find(".vDateField"),n=i.find(".vTimeField");t(a),t(n),a.nextAll("br").first().remove()})},n=function(){e(".form-row .vDateField").each(function(){var t=e(this),a=e('<a href="#">').addClass("vDateField-link"),n=e("<span>").addClass("icon-calendar");a.append(n).insertAfter(t),t.datepicker({dateFormat:i(DATE_FORMAT),showButtonPanel:!0,nextText:"",prevText:""}),a.on("click",function(e){t.datepicker(t.datepicker("widget").is(":visible")?"hide":"show"),e.preventDefault()})});var t=e.datepicker._gotoToday;e.datepicker._gotoToday=function(e){t.call(this,e),this._selectDate(e)}},o=function(){e(".form-row .vTimeField").each(function(){var t=e(this),i=e('<a href="#">').addClass("vTimeField-link"),a=e("<span>").addClass("icon-clock");i.append(a).insertAfter(t),t.timepicker({showPeriodLabels:!1,showCloseButton:!0,showNowButton:!0}),i.on("click",function(e){t.datepicker("widget").is(":visible")?t.datepicker("hide"):t.timepicker("show"),e.preventDefault()})})};a(),n(),o()},c=function(){e(".module").each(function(){var t=e(this),i=function(){return t.find(".stacked-inline-list-item")},a=function(){return t.find(".inline-related")};t.on("click",".stacked-inline-list-item-link",function(t){var n=e(this),o=n.closest(".stacked-inline-list-item"),l=n.data("inline-related-id");i().removeClass("selected"),o.addClass("selected"),a().removeClass("selected").filter("#"+l).addClass("selected"),t.preventDefault()}),t.on("click",".stacked-inline-list-item-link-remove",function(t){var i=e(this).closest(".stacked-inline-list-item-link"),n=i.closest(".stacked-inline-list-item"),o=i.data("inline-related-id");n.remove(),a().filter("#"+o).remove(),t.preventDefault()}),t.find(".inline-related").each(function(){var i=e(this);i.find(".delete input").on("change",function(){var a=e(this),n=i.attr("id"),o=t.find('.stacked-inline-list-item-link[data-inline-related-id="'+n+'"]'),l=o.closest(".stacked-inline-list-item");a.is(":checked")?l.addClass("delete"):l.removeClass("delete")})}),t.find(".add-row a").on("click",function(){t.find("select").trigger("select:init")})})},u=function(){var t=function(){var t=e(".results thead");if(0!=t.length){var i=t.clone(),a=e("<table>").addClass("table helper").append(i);a.find(".action-checkbox-column").empty(),a.appendTo(document.body);var n=function(){e(window).scrollTop()>t.offset().top?a.show():a.hide()},o=function(){var a=t.find("th"),n=i.find("th");a.each(function(t){n.eq(t).css("width",e(this).width())})};e(window).on("scroll",n),e(window).on("resize",o),o()}},i=function(){var t=e(".changelist-footer");if(0!=t.length){var i=function(){t.each(function(){var t=e(this),i=t.siblings(".results");if(e(window).scrollTop()+e(window).height()<e(document).height()){if(!t.hasClass("fixed")){var a=e(window).scrollTop();t.addClass("fixed"),i.css("margin-bottom",t.outerHeight(!1)-20-2+"px"),e(window).scrollTop(a)}}else t.hasClass("fixed")&&(t.removeClass("fixed"),i.css("margin-bottom",0))})};e(window).on("scroll",i),e(window).on("resize",i),i()}},a=function(){e('img[src$="admin/img/icon-yes.gif"]').after(e('<span class="icon-tick">')),e('img[src$="admin/img/icon-no.gif"]').after(e('<span class="icon-cross">')),e('img[src$="admin/img/icon-unknown.gif"]').after(e('<span class="icon-question">'))},n=function(){e("#result_list tbody th, #result_list tbody td").on("click",function(t){t.target==this&&e(this).closest("tr").find(".action-checkbox .action-select").click()})};t(),i(),a(),n()},f=function(){e("a[title],.tooltip[title]").tooltip({track:!0})},p=function(){var t=function(){var t=e("#update-dashboard-modules-form"),i=[];e(".dashboard-column").each(function(){var t=e(this),a=t.closest(".dashboard-column-wrapper").index();t.find(".dashboard-item").each(function(){var t=e(this),n=t.index(),o=t.data("module-id");i.push({id:o,column:a,order:n})})}),t.find('[name="modules"]').val(JSON.stringify(i)),e.ajax({url:t.attr("action"),method:t.attr("method"),dataType:"json",data:t.serialize()})};e(".dashboard-column").droppable({activeClass:"active",hoverClass:"hovered",tolerance:"pointer",accept:".dashboard-item"}).sortable({items:".dashboard-item",handle:".dashboard-item-header",tolerance:"pointer",connectWith:".dashboard-column",cursor:"move",placeholder:"dashboard-item placeholder",forcePlaceholderSize:!0,update:function(){t()}}),e(".dashboard-item.collapsible").each(function(){var t=e(this),i=t.find(".dashboard-item-collapse"),a=t.find(".dashboard-item-content"),n=e("#update-dashboard-module-collapse-form"),o=t.data("module-id");i.on("click",function(i){i.preventDefault(),a.slideFadeToggle(200,"swing",function(){var i=0==a.is(":visible");i?t.addClass("collapsed"):t.removeClass("collapsed"),n.find('[name="id"]').val(o),n.find('[name="collapsed"]').val(i?"true":"false"),e.ajax({url:n.attr("action"),method:n.attr("method"),dataType:"json",data:n.serialize()})})})}),e(".dashboard-item.deletable").each(function(){var t=e(this),i=t.find(".dashboard-item-remove"),a=e("#remove-dashboard-module-form"),n=t.data("module-id");i.on("click",function(i){i.preventDefault();var o={},l=function(){t.fadeOut(200,"swing",function(){a.find('[name="id"]').val(n),e.ajax({url:a.attr("action"),method:a.attr("method"),dataType:"json",data:a.serialize()})})};o[django.gettext("Delete")]=function(){l(),e(this).dialog("close")},o[django.gettext("Cancel")]=function(){e(this).dialog("close")},e("#module-remove-dialog").dialog({resizable:!1,modal:!0,buttons:o})})});var i=e("#add-dashboard-module-form");i.find(".add-dashboard-link").on("click",function(t){var a=i.find('[name="type"]'),n=i.find('[name="module"] option:selected').data("type");n&&(a.val(n),e.ajax({url:i.attr("action"),method:i.attr("method"),dataType:"json",data:i.serialize(),success:function(e){e.error||(document.location=e.success_url)}})),t.preventDefault()}),e(".dashboard-item.ajax").each(function(){var t=e(this),a=t.find(".dashboard-item-content"),n=t.data("ajax-url"),o=t.data("module-id");i.find('[name="id"]').val(o),e.ajax({url:n,dataType:"json",success:function(e){if(e.error)return void a.empty();var t=a.height();a.html(e.html);var i=a.height();a.height(t),a.animate({height:i},250)},error:function(){a.empty()}})}),e(".reset-dashboard-link").on("click",function(t){var i={},a=function(){var t=e("#reset-dashboard-form");e.ajax({url:t.attr("action"),method:t.attr("method"),dataType:"json",data:t.serialize(),success:function(e){e.error||location.reload()}})};i[django.gettext("Yes")]=function(){a(),e(this).dialog("close")},i[django.gettext("Cancel")]=function(){e(this).dialog("close")},e("#reset-dashboard-dialog").dialog({resizable:!1,modal:!0,buttons:i}),t.preventDefault()})},m=function(){var t=e(".changeform");if(t.length){var i=t.find("input, textarea, select"),a=!1,n=function(){return django.gettext("Warning: you have unsaved changes")},o=function(){i.off("change",o),a||(e(window).bind("beforeunload",n),a=!0)};e(document).on("submit","form",function(){e(window).off("beforeunload",n)}),i.on("change",o)}},h=function(){e(".sidebar-menu-wrapper").perfectScrollbar()},v=function(){e(".choose-theme").on("click",function(){var t=e(this);e.cookie("JET_THEME",t.data("theme"),{expires:365,path:"/"});var i=[{url:t.data("base-stylesheet"),"class":"base-stylesheet"},{url:t.data("select2-stylesheet"),"class":"select2-stylesheet"},{url:t.data("jquery-ui-stylesheet"),"class":"jquery-ui-stylesheet"}],a=0,n=function(){++a,a==i.length&&e(document).trigger("theme:changed")};i.forEach(function(t){e("<link>").attr("rel","stylesheet").addClass(t["class"]).attr("href",t.url).load(n).appendTo("head"),e("."+t["class"]).slice(0,-2).remove()}),e(".choose-theme").removeClass("selected"),t.addClass("selected")})},b=function(){var t=function(){var t=e(".related-popup"),i=e(".related-popup-container"),a=t.last();a.remove(),1==t.length&&i.fadeOut(200,"swing",function(){e(".related-popup-back").hide(),e("body").removeClass("non-scrollable")})};e(".related-popup-back").on("click",function(e){e.preventDefault(),t()}),e(window).on("related-popup:close",function(){t()})};s(),d(),t(),i(),a(),n(),o(),l(),r(),c(),u(),f(),p(),m(),h(),v(),b()})}(jet.jQuery);